<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Gauniv.Client.ViewModel"
             xmlns:services="clr-namespace:Gauniv.WebServer.Dtos"
             x:Class="Gauniv.Client.Pages.Index"
             x:DataType="vm:IndexViewModel">

    <VerticalStackLayout Padding="10">

        <!-- Filter: Category -->
        <Label Text="Filter by Category:" FontSize="Medium" />
        <Picker ItemsSource="{Binding AvailableCategories}"
                SelectedItem="{Binding SelectedCategory, Mode=TwoWay}" />

        <!-- Button to manually refresh games if needed -->
        <Button Text="Load / Refresh Games" Command="{Binding LoadGamesCommand}" />

        <!-- Game List -->
        <CollectionView ItemsSource="{Binding Games}"
                        RemainingItemsThreshold="3"
                        RemainingItemsThresholdReachedCommand="{Binding LoadMoreGamesCommand}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="services:GameDto">
                    <VerticalStackLayout Spacing="5" Padding="5" BackgroundColor="LightGray">
                        <Label Text="{Binding Name}" FontSize="Medium" FontAttributes="Bold" />
                        <Label Text="{Binding Description}" FontSize="Small" />
                        <Button Text="DÃ©tails"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:IndexViewModel}}, Path=GoToGameDetailsCommand}"
                                CommandParameter="{Binding .}" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- 'Load More' button (optional if using RemainingItemsThreshold) -->
        <Button Text="Load More" Command="{Binding LoadMoreGamesCommand}" 
                IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}" />

    </VerticalStackLayout>
</ContentPage>
